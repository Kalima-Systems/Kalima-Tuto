var fs=require("fs"),btoa=require("btoa"),utils=require("./utils.js"),fileDir="",fifo="",responseDict={},kalimaApi={init:function(e){fifo=(fileDir=e)+"/requests_fifo",watchFile()},get(e,i){var t=utils.getRandomFileName();responseDict[t]=i,utils.writeFifo(fifo,t+":"+e.headers.authorization+":GET:"+e.url+"\n")},delete(e,i){var t=utils.getRandomFileName();responseDict[t]=i,utils.writeFifo(fifo,t+":"+e.headers.authorization+":DELETE:"+e.url+"\n")},post(e,i){var t=utils.getRandomFileName();responseDict[t]=i,utils.writeFifo(fifo,t+":"+e.headers.authorization+":POST:"+e.url+"?data="+btoa(JSON.stringify(e.body))+"\n")}};function watchFile(){var s=fileDir+"/files/";fs.existsSync(s)||fs.mkdirSync(s,{recursive:!0}),fs.watch(s,function(e,i){var t=s+i;"rename"===e&&(fs.existsSync(t)?onResult(t,responseDict[i],i):onDelete(i))})}function onResult(e,i,t){var s=fs.readFileSync(e,"utf8").split(/\r?\n/);fs.unlinkSync(e),i.status(parseInt(s[0]));try{var r=JSON.parse(s[1]);i.json(r)}catch(e){i.sendStatus(parseInt(s[0]))}delete responseDict[t]}function onDelete(e){delete responseDict[e]}module.exports=kalimaApi;